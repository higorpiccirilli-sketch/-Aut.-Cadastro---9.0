<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      /* === IMPORTANDO A PALETA DO PROJETO === */
      :root {
        --bg: #1f232a;
        --panel: #282c34;
        --text: #cfd6df;
        --muted: #9aa4b2;
        --border: #353b45;
        --accent: #61afef;      /* azul */
        --accent-warm: #f39c12; /* laranja (prim√°rio) */
        --shadow: 0 6px 20px rgba(0,0,0,.25);
        --radius: 12px;
      }

      body { 
        font-family: 'Roboto', sans-serif; 
        background: var(--bg); 
        color: var(--text); 
        margin: 0; 
        padding: 20px; 
      }

      h2 { 
        font-size: 18px; 
        color: var(--text); 
        margin-top: 0; 
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      h2::before {
        content: "üè∑Ô∏è";
        font-size: 20px;
      }

      .header-actions { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 20px; 
        padding-bottom: 15px;
        border-bottom: 1px dashed var(--border);
      }

      /* === BOT√ïES (Baseado em EstilosPainel.html) === */
      .btn { 
        padding: 8px 16px; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        font-weight: 700; 
        font-size: 13px; 
        transition: filter .15s ease, transform .02s ease-in;
        box-shadow: var(--shadow);
      }
      .btn:active { transform: translateY(1px); }
      .btn:hover { filter: brightness(1.1); }

      /* Bot√£o Secund√°rio (Copiar) */
      .btn-copy { 
        background: #3b4352; 
        color: #e5eaf1; 
        border: 1px solid var(--border);
      }

      /* Bot√£o Prim√°rio (Enviar) */
      .btn-submit { 
        background: var(--accent-warm); 
        color: #1a1205; /* Texto escuro para contraste no laranja */
        width: 100%; 
        padding: 12px; 
        font-size: 14px; 
        margin-top: 20px; 
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* === CARDS DOS ITENS === */
      .item-card { 
        background: var(--panel); 
        border: 1px solid var(--border); 
        border-radius: var(--radius); 
        padding: 12px; 
        margin-bottom: 10px; 
        display: flex; 
        align-items: center; 
        gap: 15px; 
        transition: border-color 0.2s;
      }
      
      .item-card:hover {
        border-color: var(--accent);
      }

      .item-info { flex: 1; }
      
      .sku { 
        font-weight: bold; 
        color: var(--accent); /* Azul para destaque do SKU */
        font-size: 12px; 
        margin-bottom: 4px;
      }
      
      .nome { 
        font-size: 14px; 
        color: var(--text);
      }

      /* === INPUTS DARK === */
      .input-tema { 
        padding: 10px; 
        background: #1a1d23; /* Fundo mais escuro que o painel */
        border: 1px solid var(--border); 
        border-radius: 6px; 
        width: 160px; 
        font-size: 14px; 
        color: white;
        outline: none;
        transition: border-color 0.2s;
      }
      
      .input-tema:focus {
        border-color: var(--accent);
      }
      
      .input-tema::placeholder {
        color: var(--muted);
        font-style: italic;
      }

      .loading { text-align: center; color: var(--muted); margin-top: 50px; display: none; }
      
      /* Scrollbar estilizada para combinar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: var(--bg); }
      ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #555; }

    </style>
  </head>
  <body>

    <div id="main-content">
      <div class="header-actions">
        <h2>Definir Caracter√≠sticas</h2>
        <button type="button" class="btn btn-copy" onclick="copiarPrimeiroTema()">‚¨áÔ∏è Copiar 1¬∫ p/ todos</button>
      </div>

      <form id="form-caracteristicas">
        <div id="lista-itens"></div>
        <button type="submit" class="btn btn-submit">‚úÖ Gerar Arquivo</button>
      </form>
    </div>

    <div id="loading-view" class="loading">
      <p style="font-size: 24px;">‚è≥</p>
      <p>Processando... Por favor, aguarde.</p>
    </div>

    <script>
      // Mant√©m a l√≥gica original intacta
      const dadosIniciais = <?!= dadosIniciais ?>;

      function renderizarItens() {
        const container = document.getElementById('lista-itens');
        let html = '';
        
        if (!dadosIniciais || dadosIniciais.length === 0) {
          container.innerHTML = '<p style="text-align:center; color:var(--err);">‚ö†Ô∏è Nenhum dado recebido. Verifique a sele√ß√£o.</p>';
          return;
        }

        dadosIniciais.forEach((item, index) => {
          html += `
            <div class="item-card">
              <div class="item-info">
                <div class="sku">${item.sku || 'SKU N/D'}</div>
                <div class="nome">${item.nome || 'Nome N/D'}</div>
              </div>
              <input type="text" 
                     name="tema_${index}" 
                     class="input-tema" 
                     placeholder="Tema (Opcional)"
                     data-index="${index}"
                     autocomplete="off">
            </div>
          `;
        });
        container.innerHTML = html;
      }

      function copiarPrimeiroTema() {
        const inputs = document.querySelectorAll('.input-tema');
        if (inputs.length > 0) {
          const valor = inputs[0].value;
          // Efeito visual r√°pido para mostrar que copiou
          inputs.forEach(input => {
            input.value = valor;
            input.style.borderColor = 'var(--ok)'; // pisca verde (precisaria definir var --ok ou usar cor fixa)
            setTimeout(() => input.style.borderColor = '', 300);
          });
        }
      }

      document.getElementById('form-caracteristicas').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const inputs = document.querySelectorAll('.input-tema');
        const dadosFinais = dadosIniciais.map((item, index) => {
          return {
            sku: item.sku,
            nome: item.nome,
            tema: inputs[index].value
          };
        });

        document.getElementById('main-content').style.display = 'none';
        document.getElementById('loading-view').style.display = 'block';

        google.script.run
          .withSuccessHandler((msg) => {
            google.script.host.close();
          })
          .withFailureHandler((err) => {
            alert('Erro: ' + err.message);
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('loading-view').style.display = 'none';
          })
          .processarGeracaoCaracteristicasDoFrontend(dadosFinais);
      });

      renderizarItens();
    </script>
  </body>
</html>
